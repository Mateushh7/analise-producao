<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise produção</title>
    <!-- Carrega o Tailwind CSS para estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega a biblioteca Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Estilos personalizados para o editor de colagem */
        #pasteBox:empty::before {
            content: "Clique aqui e cole a tabela (Ctrl+V)...";
            color: #9ca3af; /* text-gray-400 */
            font-style: italic;
        }
    </style>
</head>
<!-- MODIFICADO: Voltando ao body centralizado -->
<body class="bg-gray-100 min-h-screen flex items-center justify-center font-sans p-4">

    <!-- MODIFICADO: max-w-7xl de volta para max-w-6xl (o tamanho original) -->
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-6xl"> 
        
        <h1 class="text-2xl font-bold text-center text-blue-700 mb-6">Análise produção</h1>

        <!-- Instruções -->
        <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md mb-6">
            <h3 class="font-bold mb-2">Como usar:</h3>
            <ol class="list-decimal list-inside space-y-1">
                <li>Na tela "Produção hora em hora", selecione a tabela inteira com o mouse.</li>
                <li>Copie a tabela (use o atalho <code class="font-mono bg-blue-100 px-1 rounded">Ctrl+C</code>).</li>
                <li>Clique na caixa abaixo e cole a tabela (use <code class="font-mono bg-blue-100 px-1 rounded">Ctrl+V</code>).</li>
                <li>Clique no botão "Processar Dados".</li>
            </ol>
        </div>

        <!-- Área de Colagem (ContentEditable) -->
        <div id="pasteBox"
             contenteditable="true"
             class="w-full h-48 p-4 border-2 border-dashed border-gray-300 rounded-lg overflow-y-auto bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
             role="textbox"
             aria-multiline="true"
             aria-label="Área para colar a tabela">
        </div>

        <!-- Botão de Ação -->
        <button id="extractButton" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300 mt-6 shadow-md">
            Processar Dados
        </button>

        <!-- Mensagens de Status -->
        <div id="statusMessage" class="mt-4 text-center text-sm font-medium"></div>

        <!-- Área de Resultados (Gráfico e Cálculos) -->
        <div id="resultsArea" class="mt-8 hidden">
            
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2">Análise da Produção</h2>

            <!-- SEÇÃO DE CÁLCULOS TOTAIS REMOVIDA -->
            <!-- SEÇÃO DE ANÁLISE DO CORTE REMOVIDA -->

            <!-- Nova Tabela de Detalhes -->
            <h2 class="text-xl font-semibold text-gray-800 mb-4 mt-8">Detalhes por Setor</h2>
            <div class="w-full overflow-x-auto bg-gray-50 p-4 rounded-lg shadow-inner">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <!-- CABEÇALHO DA TABELA MODIFICADO -->
                        <tr>
                            <th rowspan="2" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider align-middle">Setor</th>
                            <!-- COLUNA ADICIONADA -->
                            <th rowspan="2" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider align-middle bg-gray-200">Total Dia</th>
                            <!-- Colunas Manhã -->
                            <th colspan="3" class="px-4 py-3 text-center text-xs font-medium text-blue-700 uppercase tracking-wider bg-blue-50">Manhã (7h-12h)</th>
                            <!-- Colunas Tarde -->
                            <th colspan="3" class="px-4 py-3 text-center text-xs font-medium text-green-700 uppercase tracking-wider bg-green-50">Tarde (13h-16h)</th>
                            <!-- Colunas Fora Horário -->
                            <th colspan="3" class="px-4 py-3 text-center text-xs font-medium text-yellow-700 uppercase tracking-wider bg-yellow-50">Fora Horário (17h-21h)</th>
                            <!-- Colunas Noite -->
                            <th colspan="3" class="px-4 py-3 text-center text-xs font-medium text-indigo-700 uppercase tracking-wider bg-indigo-50">Noite (22h-6h)</th>
                        </tr>
                        <tr>
                            <!-- Sub-colunas Manhã -->
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-blue-50">Total</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-blue-50">Média/h</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-blue-50">% do Setor</th>
                            <!-- Sub-colunas Tarde -->
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-green-50">Total</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-green-50">Média/h</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-green-50">% do Setor</th>
                            <!-- Sub-colunas Fora Horário -->
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-yellow-50">Total</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-yellow-50">Média/h</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-yellow-50">% do Setor</th>
                            <!-- Sub-colunas Noite -->
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-indigo-50">Total</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-indigo-50">Média/h</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-indigo-50">% do Setor</th>
                        </tr>
                    </thead>
                    <tbody id="sectorTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Linhas serão inseridas aqui via JS -->
                    </tbody>
                </table>
            </div>

            <!-- Gráfico -->
            <h2 class="text-xl font-semibold text-gray-800 mb-4 mt-8">Produção por Período (Gráfico)</h2>
            <div class="bg-gray-50 p-4 rounded-lg shadow-inner">
                <canvas id="productionChart"></canvas>
            </div>

            <!-- NOVO: Gráfico de Linha por Setor -->
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2 mt-12">Análise por Setor (Produção/Hora)</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Selecione os Setores para analisar:</label>
                <!-- Remove o <select> e adiciona um container para os checkboxes -->
                <div id="sectorCheckboxContainer" class="w-full max-h-40 overflow-y-auto p-3 border border-gray-300 rounded-lg bg-gray-50 shadow-sm space-y-2">
                    <!-- Checkboxes serão preenchidas via JS -->
                </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg shadow-inner">
                <canvas id="hourlyChart"></canvas>
            </div>
        </div>

    </div>

    <script>
        // Variável global para guardar a instância do gráfico e poder destruí-la
        let myChart;
        
        // MODIFICADO: Formatador de números global para 'en-US' (usa . como decimal)
        const formatter = new Intl.NumberFormat('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
        
        // MODIFICADO: Formatador de porcentagem para 'en-US'
        const formatterPct = new Intl.NumberFormat('en-US', {
            style: 'percent',
            minimumFractionDigits: 1,
            maximumFractionDigits: 1
        });
        
        // Define a duração (em horas) de cada período
        const periodDurations = {
            manha: 6,       // 7, 8, 9, 10, 11, 12 (6 horas)
            tarde: 4,       // 13, 14, 15, 16 (4 horas)
            foraHorario: 5, // 17, 18, 19, 20, 21 (5 horas)
            noite: 9        // 22, 23, 0, 1, 2, 3, 4, 5, 6 (9 horas)
        };
        // Variável global para o novo gráfico de linha
        let hourlyChartInstance;
        // Variáveis globais para guardar os dados parseados
        let parsedDataCache = {};


        document.getElementById('extractButton').addEventListener('click', () => {
            const pasteBox = document.getElementById('pasteBox');
            const statusMessage = document.getElementById('statusMessage');
            const resultsArea = document.getElementById('resultsArea');

            // Esconde resultados antigos
            resultsArea.classList.add('hidden');
            
            // 1. Obter o HTML colado
            const pastedHtml = pasteBox.innerHTML;
            if (!pastedHtml.trim()) {
                showMessage("A caixa de colagem está vazia. Cole a tabela primeiro.", "error");
                return;
            }

            // 2. Criar um elemento temporário para analisar o HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = pastedHtml;
            const table = tempDiv.querySelector('table');

            if (!table) {
                showMessage("Nenhuma tabela foi encontrada no conteúdo colado.", "error");
                return;
            }

            // --- 3. GERAÇÃO DO CSV (REMOVIDA) ---

            // --- 4. ANÁLISE DE DADOS (Nova Lógica) ---
            try {
                // Parseia a tabela para um objeto JS com números
                const parsedData = parseHtmlTable(table);
                // Salva os dados no cache global
                parsedDataCache = parsedData;

                // Calcula os totais dos períodos
                const analysisResults = analyzeProductionData(parsedData.data);

                // FUNÇÃO displayTotals REMOVIDA
                // FUNÇÃO displayCorteAverage REMOVIDA
                
                // Exibe a nova tabela de detalhes
                // MODIFICADO: Não precisa mais do grandTotalProduction
                displaySectorTable(analysisResults.sectorBreakdown);

                // Exibe o gráfico
                displayProductionChart(analysisResults.sectorBreakdown);

                // Popula o seletor de setor
                populateSectorCheckboxes(parsedData.data);

                // Exibe o gráfico de linha para o primeiro setor por padrão
                if (parsedData.data.length > 0) {
                    const firstSectorName = parsedData.data[0][Object.keys(parsedData.data[0])[0]];
                    displayHourlyChart([firstSectorName]); // Passa como um array
                }

                // Mostra a área de resultados
                resultsArea.classList.remove('hidden');
                showMessage("Dados processados com sucesso!", "success"); // Mensagem atualizada

            } catch (error) {
                console.error("Erro ao analisar dados:", error);
                showMessage("Erro ao analisar dados para gráfico/cálculos.", "error");
            }
        }); // <-- FECHA O 'extractButton' EVENT LISTENER

        // Função para parsear a tabela para objetos JS
        function parseHtmlTable(table) {
            const headers = [];
            // Pega os cabeçalhos (assume primeira linha)
            table.querySelectorAll('tr')[0].querySelectorAll('th, td').forEach(cell => {
                headers.push(cell.innerText.trim());
            });

            const data = [];
            const rows = table.querySelectorAll('tr');

            // Itera sobre as linhas de dados (começa de i=1 para pular cabeçalho)
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.querySelectorAll('td');
                if (cells.length === 0) continue;

                const rowData = {};
                let isTotalRow = false; // Flag para ignorar a linha "Total"

                headers.forEach((header, index) => {
                    const cell = cells[index];
                    if (!cell) return;
                    
                    const cellText = cell.innerText.trim();

                    if (index === 0) {
                        // Primeira coluna (Setor) é texto
                        rowData[header] = cellText;
                        if (cellText.toLowerCase() === 'total') {
                            isTotalRow = true;
                        }
                    } else {
                        // Outras colunas são números
                        // Remove ',' (milhar) e usa '.' como decimal
                        const numericValue = cellText.replace(/,/g, ''); 
                        
                        rowData[header] = parseFloat(numericValue) || 0;
                    }
                });

                // Só adiciona a linha se NÃO for a linha de "Total"
                if (!isTotalRow) {
                    data.push(rowData);
                }
            }
            return { headers, data };
        }

        // Função para calcular os totais
        function analyzeProductionData(data) {
            let grandTotalManha = 0;
            let grandTotalTarde = 0;
            let grandTotalForaHorario = 0;
            let grandTotalNoite = 0;
            let grandTotalProduction = 0; // Para calcular a %
            const sectorBreakdown = [];

            // Cabeçalhos que não são de produção por período
            const nonProductionPeriodHeaders = ['setor', 'total'];

            data.forEach(row => {
                let manha = 0;
                let tarde = 0;
                let foraHorario = 0;
                let noite = 0;
                const setor = row[Object.keys(row)[0]]; // Pega o nome do setor

                Object.keys(row).forEach(header => {
                    const headerClean = header.toLowerCase();
                    // Pula se for "Setor" ou "Total"
                    if (nonProductionPeriodHeaders.includes(headerClean)) return; 
                    
                    // Extrai a hora
                    const hour = parseInt(header.replace('h', ''));
                    if (isNaN(hour)) return; // Pula se não for uma hora (ex: "Total")

                    const value = row[header];

                    // Classifica a hora
                    if (hour >= 7 && hour <= 12) {
                        manha += value;
                    } else if (hour >= 13 && hour <= 16) {
                        tarde += value;
                    } else if (hour >= 17 && hour <= 21) {
                        foraHorario += value;
                    } else if (hour >= 22 || (hour >= 0 && hour <= 6)) {
                        noite += value;
                    }
                });
                
                // Pega o total do setor (da coluna 'Total')
                const totalSetor = row['Total'] || 0;
                grandTotalProduction += totalSetor;

                // Adiciona totais do setor
                sectorBreakdown.push({ setor, manha, tarde, foraHorario, noite, totalSetor }); // adiciona totalSetor

                // Adiciona aos totais gerais
                grandTotalManha += manha;
                grandTotalTarde += tarde;
                grandTotalForaHorario += foraHorario;
                grandTotalNoite += noite;
            });

            // Retorna o total geral para cálculo da %
            return { grandTotalManha, grandTotalTarde, grandTotalForaHorario, grandTotalNoite, grandTotalProduction, sectorBreakdown }; 
        }

        // --- FUNÇÕES DE EXIBIÇÃO ---

        // FUNÇÃO displayCorteAverage REMOVIDA
        // FUNÇÃO displayTotals REMOVIDA

        // Nova função para popular a tabela de detalhes
        // MODIFICADA: Calcula médias e % por período
        function displaySectorTable(sectorBreakdown) {
            const tbody = document.getElementById('sectorTableBody');
            tbody.innerHTML = ''; // Limpa tabela

            sectorBreakdown.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';
                
                const totalSetor = item.totalSetor || 0;

                // Cálculos de Média e Porcentagem por período
                const avgManha = (periodDurations.manha > 0) ? (item.manha / periodDurations.manha) : 0;
                const pctManha = (totalSetor > 0) ? (item.manha / totalSetor) : 0; // valor de 0 a 1

                const avgTarde = (periodDurations.tarde > 0) ? (item.tarde / periodDurations.tarde) : 0;
                const pctTarde = (totalSetor > 0) ? (item.tarde / totalSetor) : 0;

                const avgForaHorario = (periodDurations.foraHorario > 0) ? (item.foraHorario / periodDurations.foraHorario) : 0;
                const pctForaHorario = (totalSetor > 0) ? (item.foraHorario / totalSetor) : 0;

                const avgNoite = (periodDurations.noite > 0) ? (item.noite / periodDurations.noite) : 0;
                const pctNoite = (totalSetor > 0) ? (item.noite / totalSetor) : 0;
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.setor}</td>
                    
                    <!-- CÉLULA ADICIONADA -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-800 bg-gray-100">${formatter.format(totalSetor)}</td>

                    <!-- Manhã -->
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-700">${formatter.format(item.manha)}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${formatter.format(avgManha)}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-blue-700 font-medium">${formatterPct.format(pctManha)}</td>
                    
                    <!-- Tarde -->
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-700">${formatter.format(item.tarde)}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${formatter.format(avgTarde)}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-green-700 font-medium">${formatterPct.format(pctTarde)}</td>
                    
                    <!-- Fora Horário -->
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-700">${formatter.format(item.foraHorario)}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${formatter.format(avgForaHorario)}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-yellow-700 font-medium">${formatterPct.format(pctForaHorario)}</td>
                    
                    <!-- Noite -->
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-700">${formatter.format(item.noite)}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${formatter.format(avgNoite)}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-indigo-700 font-medium">${formatterPct.format(pctNoite)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Função para desenhar o gráfico (agora agrupado)
        function displayProductionChart(sectorBreakdown) {
            const ctx = document.getElementById('productionChart').getContext('2d');
            
            const labels = sectorBreakdown.map(item => item.setor); // Nomes dos setores
            const manhaData = sectorBreakdown.map(item => item.manha);
            const tardeData = sectorBreakdown.map(item => item.tarde);
            const foraHorarioData = sectorBreakdown.map(item => item.foraHorario);
            const noiteData = sectorBreakdown.map(item => item.noite);

            // Destrói gráfico antigo, se existir
            if (myChart) {
                myChart.destroy();
            }

            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Manhã (7h-12h)',
                            data: manhaData,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)', // Azul
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Tarde (13h-16h)',
                            data: tardeData,
                            backgroundColor: 'rgba(75, 192, 192, 0.6)', // Verde
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Fora Horário (17h-21h)',
                            data: foraHorarioData,
                            backgroundColor: 'rgba(255, 206, 86, 0.6)', // Amarelo
                            borderColor: 'rgba(255, 206, 86, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Noite (22h-6h)',
                            data: noiteData,
                            backgroundColor: 'rgba(75, 0, 130, 0.6)', // Indigo/Roxo
                            borderColor: 'rgba(75, 0, 130, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatter.format(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatter.format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Popula o <div> com checkboxes
        function populateSectorCheckboxes(data) {
            const container = document.getElementById('sectorCheckboxContainer');
            container.innerHTML = ''; // Limpa opções antigas

            data.forEach((row, index) => {
                const sectorName = row[Object.keys(row)[0]]; // Pega o nome do setor (primeira coluna)
                
                // Cria o HTML para o checkbox e a label
                const checkboxHTML = `
                    <div class="flex items-center p-1 hover:bg-gray-100 rounded">
                        <input type="checkbox" 
                               id="sector-cb-${index}" 
                               value="${sectorName}" 
                               class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                               ${index === 0 ? 'checked' : ''}> <!-- Marca o primeiro por padrão -->
                        <label for="sector-cb-${index}" class="ml-2 block text-sm text-gray-900">${sectorName}</label>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', checkboxHTML);
            });

            // Adiciona o event listener ao container PAI
            // Isso é mais eficiente do que adicionar um listener para cada checkbox
            container.addEventListener('change', () => {
                const selectedSectors = [];
                // Encontra todos os checkboxes marcados DENTRO do container
                container.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                    selectedSectors.push(checkbox.value);
                });
                displayHourlyChart(selectedSectors);
            });

        }

        // Desenha o gráfico de linha por hora para MÚLTIPLOS setores
        function displayHourlyChart(selectedSectorNamesArray) {
            const ctx = document.getElementById('hourlyChart').getContext('2d');
            const { headers, data } = parsedDataCache;

            // Define um pool de cores para os gráficos
            const chartColors = [
                'rgba(239, 68, 68, 1)',   // Red
                'rgba(54, 162, 235, 1)',  // Blue
                'rgba(75, 192, 192, 1)',  // Green
                'rgba(255, 206, 86, 1)',  // Yellow
                'rgba(139, 92, 246, 1)',  // Indigo
                'rgba(255, 159, 64, 1)',  // Orange
                'rgba(153, 102, 255, 1)', // Purple
                'rgba(255, 99, 132, 1)'   // Pink
            ];
            const chartBgColors = [
                'rgba(239, 68, 68, 0.1)',
                'rgba(54, 162, 235, 0.1)',
                'rgba(75, 192, 192, 0.1)',
                'rgba(255, 206, 86, 0.1)',
                'rgba(139, 92, 246, 0.1)',
                'rgba(255, 159, 64, 0.1)',
                'rgba(153, 102, 255, 0.1)',
                'rgba(255, 99, 132, 0.1)'
            ];

            const chartLabels = [];
            const datasets = [];

            // 1. Pega os cabeçalhos das horas (ex: "0h", "1h"...)
            // Isso só precisa ser feito uma vez
            headers.forEach(header => {
                const hour = parseInt(header.replace('h', ''));
                if (!isNaN(hour) && hour >= 0 && hour <= 23) {
                    chartLabels.push(header);
                }
            });

            // 2. Cria um dataset para CADA setor selecionado
            selectedSectorNamesArray.forEach((sectorName, index) => {
                // Encontra os dados do setor selecionado
                const sectorData = data.find(row => row[Object.keys(row)[0]] === sectorName);
                if (!sectorData) return; // Pula se não encontrar

                const chartDataPoints = [];

                // Pega os dados de produção para cada hora
                chartLabels.forEach(label => {
                    chartDataPoints.push(sectorData[label] || 0);
                });

                // Usa o index para pegar uma cor do pool (dando a volta se acabar)
                const colorIndex = index % chartColors.length;

                // Adiciona o dataset para este setor
                datasets.push({
                    label: `Produção de ${sectorName}`,
                    data: chartDataPoints,
                    borderColor: chartColors[colorIndex],
                    backgroundColor: chartBgColors[colorIndex],
                    fill: true,
                    tension: 0.1 // Suaviza a linha
                });
            });

            // Destrói gráfico antigo, se existir
            if (hourlyChartInstance) {
                hourlyChartInstance.destroy();
            }

            hourlyChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: datasets // Passa o array de datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatter.format(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true // Mostrar a legenda
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatter.format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Função para exibir mensagens de status
        function showMessage(message, type = "info") {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.textContent = message;
            if (type === "error") {
                statusMessage.className = "mt-4 text-center text-sm font-medium text-red-600";
            } else if (type === "success") {
                statusMessage.className = "mt-4 text-center text-sm font-medium text-green-600";
            } else {
                statusMessage.className = "mt-4 text-center text-sm font-medium text-gray-700";
            }
        }

    </script>

</body>
</html>
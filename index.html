<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise de Produção</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            light: '#6DAFB8',  // Manhã
                            medium: '#2C6E7A', // Tarde
                            dark: '#163A4A',   // Noite
                            red: '#C63832',    // Fora de Horário
                            bg: '#F5F7F8'
                        },
                        slate: { 850: '#1e293b', 900: '#0f172a' }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-brand-bg min-h-screen text-slate-600 font-sans selection:bg-brand-medium selection:text-white">

    <nav class="bg-white border-b border-slate-200 sticky top-0 z-30 print:relative print:border-none">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
            
            <div class="flex flex-col md:flex-row justify-between items-center py-3 gap-4">
                
                <div class="flex items-center gap-3 self-start md:self-center">
                    <div class="flex items-center justify-center h-8 w-8 rounded bg-gradient-to-br from-brand-medium to-brand-dark text-white font-bold text-lg">
                        A
                    </div>
                    <span class="font-bold text-xl text-slate-800 tracking-tight">Análise de <span class="text-brand-red">Produção</span></span>
                </div>
                
                <div id="reportHeaderInfo" class="hidden flex-1 flex flex-col items-center justify-center text-center fade-in">
                    <p class="text-sm text-slate-500">Data de Referência: <span id="displayDate" class="font-semibold text-brand-dark">--/--/----</span></p>
                </div>

                <div id="headerControls" class="hidden flex items-center gap-2 self-end md:self-center no-print">
                    <button id="toggleInfoBtn" title="Ver regras de cálculo" class="bg-slate-50 border border-slate-300 text-slate-500 hover:text-brand-medium hover:border-brand-medium p-2 rounded-lg transition-all shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </button>

                    <button id="showInputBtn" class="group bg-white border border-slate-300 text-slate-600 hover:border-brand-medium hover:text-brand-medium px-4 py-2 rounded-lg text-sm font-medium flex items-center transition-all shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 group-hover:scale-110 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                        Nova Análise
                    </button>
                </div>
            </div>

            <div id="headerLegend" class="hidden border-t border-slate-100 bg-slate-50 mx-[-1rem] px-4 sm:px-6 lg:px-8 py-3 text-xs text-slate-600 fade-in print:block print:bg-white print:border-slate-200">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-4 gap-y-2 max-w-7xl mx-auto">
                    <div class="flex justify-between items-center lg:block">
                        <span class="font-bold text-brand-light">Manhã:</span> 
                        <span class="text-slate-500">07:00 - 11:00 <span class="font-mono ml-1 text-slate-400">(/4,75)</span></span>
                    </div>
                    <div class="flex justify-between items-center lg:block">
                        <span class="font-bold text-brand-medium">Tarde:</span> 
                        <span class="text-slate-500">13:00 - 16:00 <span class="font-mono ml-1 text-slate-400">(/4,00)</span></span>
                    </div>
                    <div class="flex justify-between items-center lg:block">
                        <span class="font-bold text-brand-red">Fora:</span> 
                        <span class="text-slate-500">12h, 17h-21h, 02h <span class="font-mono ml-1 text-slate-400">(/7,00)</span></span>
                    </div>
                    <div class="flex justify-between items-center lg:block">
                        <span class="font-bold text-brand-dark">Noite:</span> 
                        <span class="text-slate-500">22h-01h, 03h-06h <span class="font-mono ml-1 text-slate-400">(/7,61)</span></span>
                    </div>
                </div>
            </div>

        </div>
    </nav>

    <div class="container mx-auto px-4 py-8 max-w-7xl"> 

        <div id="inputSection" class="max-w-4xl mx-auto mt-6 no-print fade-in">
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 tracking-tight mb-3">Importação de Dados</h1>
                <p class="text-lg text-slate-500">Siga o passo a passo abaixo para gerar os indicadores.</p>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        
                        <div class="flex flex-col items-center text-center group">
                            <div class="h-10 w-10 rounded-full bg-slate-50 text-brand-medium flex items-center justify-center font-bold mb-3 border border-slate-200 group-hover:bg-brand-medium group-hover:text-white transition-colors">1</div>
                            <h4 class="text-sm font-bold text-slate-800 mb-2">Acessar Relatório</h4>
                            <p class="text-xs text-slate-500 mb-3 px-4">Acesse a tela "Produção hora em hora" no link abaixo:</p>
                            <a href="http://10.1.12.252/Relatorios/ProducaoHoraEmHora.aspx" target="_blank" class="inline-flex items-center px-4 py-2 bg-brand-medium hover:bg-brand-dark text-white text-xs font-bold rounded-lg transition-colors shadow-sm">
                                Produção hora em hora
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </a>
                        </div>

                        <div class="flex flex-col items-center text-center group">
                            <div class="h-10 w-10 rounded-full bg-slate-50 text-brand-medium flex items-center justify-center font-bold mb-3 border border-slate-200 group-hover:bg-brand-medium group-hover:text-white transition-colors">2</div>
                            <h4 class="text-sm font-bold text-slate-800 mb-2">Selecionar e Copiar</h4>
                            <p class="text-xs text-slate-500 px-4">No relatório, pressione <strong class="text-slate-700">Ctrl + A</strong> para selecionar tudo e <strong class="text-slate-700">Ctrl + C</strong> para copiar.</p>
                        </div>

                        <div class="flex flex-col items-center text-center group">
                            <div class="h-10 w-10 rounded-full bg-slate-50 text-brand-medium flex items-center justify-center font-bold mb-3 border border-slate-200 group-hover:bg-brand-medium group-hover:text-white transition-colors">3</div>
                            <h4 class="text-sm font-bold text-slate-800 mb-2">Colar e Processar</h4>
                            <p class="text-xs text-slate-500 px-4">Clique na caixa abaixo, pressione <strong class="text-slate-700">Ctrl + V</strong> e aguarde a confirmação.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid gap-6">
                <div class="w-full">
                    <label for="reportDate" class="block text-sm font-semibold text-slate-700 mb-2">Data de Referência</label>
                    <input type="date" id="reportDate" class="w-full sm:w-auto border border-slate-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-brand-medium focus:border-brand-medium outline-none shadow-sm text-slate-700 transition-shadow">
                </div>

                <div class="relative group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Área de Transferência</label>
                    <div class="bg-white p-1 rounded-xl shadow-sm border border-slate-300 focus-within:ring-2 focus-within:ring-brand-medium focus-within:border-brand-medium transition-all duration-200 h-32">
                        <div id="pasteBox"
                             contenteditable="true"
                             class="w-full h-full p-4 outline-none text-slate-600 text-sm font-mono leading-relaxed"
                             role="textbox"
                             aria-label="Cole sua tabela aqui">
                        </div>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 pt-2">
                    <button id="extractButton" class="h-12 flex-1 bg-brand-medium hover:bg-brand-dark text-white font-semibold rounded-lg shadow-lg shadow-slate-200 transition-all duration-200 flex items-center justify-center transform hover:-translate-y-0.5">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Gerar Dashboard
                    </button>
                    
                    <button id="clearButton" class="h-12 sm:w-auto bg-white border border-slate-300 hover:bg-brand-red hover:text-white hover:border-brand-red text-slate-600 font-medium rounded-lg shadow-sm transition-all duration-200 flex items-center justify-center px-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                        Limpar
                    </button>
                </div>

                <div id="statusMessage" class="mt-2 text-center text-sm font-medium min-h-[20px]"></div>
            </div>
        </div>

        <div id="resultsArea" class="hidden space-y-8 print-area fade-in">
            
            <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-6 lg:p-8 print-no-shadow print-no-border mt-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <div class="mb-4 md:mb-0">
                        <h3 class="text-lg font-bold text-slate-800 flex items-center">
                            <span class="w-1.5 h-6 bg-brand-medium rounded-full mr-3"></span>
                            <span id="performanceTitle">Performance por Setor</span>
                        </h3>
                        <p class="text-sm text-slate-500 font-medium mt-1 ml-4 pl-0.5">
                            Médias de produção por período
                        </p>
                    </div>
                    <div class="no-print w-full md:w-64">
                        <div class="relative">
                            <select id="overviewSectorSelect" class="block w-full pl-4 pr-10 py-2 text-sm border-slate-300 focus:outline-none focus:ring-brand-medium focus:border-brand-medium rounded-lg shadow-sm appearance-none bg-slate-50">
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                    <div class="lg:col-span-6 grid grid-cols-2 gap-4 content-start">
                        <div class="bg-slate-50 p-5 rounded-xl border-l-4 border-brand-light shadow-sm">
                            <p class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Manhã</p>
                            <div class="flex items-baseline gap-2">
                                <p id="avgManhaDisplay" class="text-3xl font-bold text-brand-light">0,00</p>
                                <span class="text-xs text-slate-400">m²/h</span>
                            </div>
                        </div>
                        <div class="bg-slate-50 p-5 rounded-xl border-l-4 border-brand-medium shadow-sm">
                            <p class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Tarde</p>
                            <div class="flex items-baseline gap-2">
                                <p id="avgTardeDisplay" class="text-3xl font-bold text-brand-medium">0,00</p>
                                <span class="text-xs text-slate-400">m²/h</span>
                            </div>
                        </div>
                        <div class="bg-slate-50 p-5 rounded-xl border-l-4 border-brand-red shadow-sm">
                            <p class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Fora Horário</p>
                            <div class="flex items-baseline gap-2">
                                <p id="avgForaDisplay" class="text-3xl font-bold text-brand-red">0,00</p>
                                <span class="text-xs text-slate-400">m²/h</span>
                            </div>
                        </div>
                        <div class="bg-slate-50 p-5 rounded-xl border-l-4 border-brand-dark shadow-sm">
                            <p class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Noite</p>
                            <div class="flex items-baseline gap-2">
                                <p id="avgNoiteDisplay" class="text-3xl font-bold text-brand-dark">0,00</p>
                                <span class="text-xs text-slate-400">m²/h</span>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-6 flex flex-col items-center">
                        <div class="relative h-72 w-full">
                            <canvas id="overviewPieChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="print-break-before"></div>

            <div class="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden print-no-shadow print-no-border">
                <div class="px-6 py-5 border-b border-slate-200 bg-slate-50 flex flex-col sm:flex-row justify-between items-center gap-4 print-no-bg">
                    <div>
                        <h2 class="text-lg font-bold text-slate-800 flex items-center">
                            <span class="w-1.5 h-6 bg-brand-medium rounded-full mr-3"></span>
                            Detalhes por setor
                        </h2>
                    </div>
                    <button id="downloadExcelBtn" class="group bg-white border border-slate-300 text-slate-600 hover:border-brand-medium hover:text-brand-medium text-sm font-medium py-2 px-3 rounded-lg transition-all shadow-sm no-print flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        Excel
                    </button>
                </div>
                
                <div class="w-full overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200 text-sm" id="detailsTable">
                        <thead>
                            <tr class="bg-slate-100 text-slate-600 print-force-bg-gray">
                                <th rowspan="2" class="px-4 py-3 text-left font-bold uppercase tracking-wider border-r border-slate-200 bg-slate-100 sticky left-0 z-10 shadow-sm print-force-bg-gray">Setor</th>
                                <th rowspan="2" class="px-4 py-3 text-center font-bold uppercase tracking-wider bg-slate-200 border-r border-slate-300 text-slate-800 print-force-bg-darker">Total (m²)</th>
                                <th colspan="3" class="px-2 py-2 text-center font-semibold text-white uppercase tracking-wider bg-brand-light border-r border-brand-light print-force-bg-manha">Manhã</th>
                                <th colspan="3" class="px-2 py-2 text-center font-semibold text-white uppercase tracking-wider bg-brand-medium border-r border-brand-medium print-force-bg-tarde">Tarde</th>
                                <th colspan="3" class="px-2 py-2 text-center font-semibold text-white uppercase tracking-wider bg-brand-red border-r border-brand-red print-force-bg-fora">Fora Horário</th>
                                <th colspan="3" class="px-2 py-2 text-center font-semibold text-white uppercase tracking-wider bg-brand-dark print-force-bg-noite">Noite</th>
                            </tr>
                            <tr class="text-xs print-force-bg-gray">
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-l border-r print-force-bg-gray">Total</th>
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-r print-force-bg-gray">Méd/h</th>
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-r print-force-bg-gray">%</th>
                                
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-r print-force-bg-gray">Total</th>
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-r print-force-bg-gray">Méd/h</th>
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-r print-force-bg-gray">%</th>
                                
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-r print-force-bg-gray">Total</th>
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-r print-force-bg-gray">Méd/h</th>
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-r print-force-bg-gray">%</th>
                                
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-r print-force-bg-gray">Total</th>
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 border-r print-force-bg-gray">Méd/h</th>
                                <th class="px-2 py-2 bg-slate-50 text-slate-600 font-medium border-t border-slate-200 print-force-bg-gray">%</th>
                            </tr>
                        </thead>
                        <tbody id="sectorTableBody" class="bg-white divide-y divide-slate-200">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="print-break-before"></div>

            <div class="grid grid-cols-1 gap-8">
                <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-6 print-no-shadow print-no-border">
                    <h2 class="text-lg font-bold text-slate-800 mb-6 flex items-center">
                        <span class="w-1.5 h-6 bg-brand-medium rounded-full mr-3"></span>
                        Produção por Turno
                    </h2>
                    <div class="relative h-96">
                        <canvas id="productionChart"></canvas>
                    </div>
                </div>

                <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-6 print-no-shadow print-no-border">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 border-b border-slate-100 pb-4">
                        <h2 class="text-lg font-bold text-slate-800 flex items-center">
                            <span class="w-1.5 h-6 bg-brand-medium rounded-full mr-3"></span>
                            Evolução de hora em hora
                        </h2>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <div class="lg:col-span-1 no-print order-2 lg:order-1">
                            <div class="bg-slate-50 rounded-lg p-3 border border-slate-200 h-full max-h-96 flex flex-col">
                                <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">Setores</label>
                                <div id="sectorCheckboxContainer" class="flex-1 overflow-y-auto space-y-1 pr-1 custom-scrollbar">
                                </div>
                            </div>
                        </div>
                        <div class="lg:col-span-3 order-1 lg:order-2">
                            <div class="relative h-80 w-full">
                                <canvas id="hourlyChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="mt-12 text-center text-slate-400 text-sm no-print pb-8">
            &copy; <script>document.write(new Date().getFullYear())</script> Sistema de Análise de Produção
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>